# JSON-логгер

Для проекта используется библиотека **python-json-logger** с кастомной конфигурацией логгера.

## Форматтеры

Логгер поддерживает 2 форматтера:

1. Форматтер, который оперирует полями из классов модуля **tools/logger/params.py**
2. Форматтер, имеющий дополнительные поля, описанные в переменной COMMON_RECORD_ATTRS класса ExtraFormatter (**tools/logger/logger.py**)

## Глобальная переменная

Для задания значений полей в логгере используется глобальная переменная **g** из модуля **tools/globals.py**. Необходимо передать в метод `set_extra_for_logs()` словарь, содержащий поля, соответствующие полям из **tools/logger/params.py**. Как только словарь был передан в метод, поле `extra_info_for_logs` переменной **g** пополняется новыми значениями, которые затем подхватываются выбранным форматтером.

## Хендлеры

По-умолчанию для логгера используются хендлеры с выводом в консоль.

## Фильтры

В конфиге логгера прописаны 3 фильтра: **debug (10)**, **info (20)**, **error (40)**.
Если приложение находится в режиме разработки (dev-stage), то логгер работает с фильтром **debug**, иначе - с фильтром **info**.

## Работа с логгером

Работа с логгером не отличается от работы со стандарныт логгером python.
Для начала объект логгера должен быть инициализирован с помощью

```python
logger = logging.getLogger(__name__)
```

Далее могут быть добавлены значения дополнительных полей для логгера, которые будут использоваться при последующих вызовах записи в лог

```python
globals.set_extra_for_logs({"session_id": "super session"})
```

После этого логгер вызывается так же, как и стандартный логгер python

```python
logger.info("Hi :)")
```

На выходе в консоли будет отображено следующее сообщение:

```json
{"asctime": "2024-11-01T20:35:55.325036", "http_referrer": "http://localhost:8080/api/v1/", "level": "INFO", "logger": {"name": "web.entrypoints.index_entrypoint", "level": "INFO"}, "message": "Hi :)", "msg": "Hi :)", "project_name": "test_project", "request": "GET", "request_body": null, "response_body": null, "response_status": null, "session_id": "super session", "status": null, "system_log_type": "application", "user_id": null}
```

Как видно из лога, единственное дополнительное поле, которое было заполнено пользователем и отлично от **null**, является поле **session_id**, значение которого равняется **super session**.
