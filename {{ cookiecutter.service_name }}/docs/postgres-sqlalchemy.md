# Подключение к Postgres через ORM SQLAlchemy

Подключение к БД Postgres реализовано через ORM SQLAlchemy в синхронном и асинхронном режиме.
Конфиг postgres находится в **config/pg_config.py**.

## Сессия

Синхронная и асинхронная сессии реализуют интерфейс **BaseSession** из **interfaces/base_session.py**. Для получения объекта сессии используется метод `get_db()`, который представляет собой контекстный менеджер.
Реализации сессий представлены в модуле **session.py** директории **storage/sqlalchemy**.

## Работа с сессией

Для получения объекта сессии используется контекстный менеджер. Разберем работу с объектом сессии на примере асинхронной сессии:

```python
async with self.session() as session:
    user = User(...)
    session.add(user)
    await session.commit()
```

Также сессия может быть инициализирована и передана через **di-контейнер**, если сделать фабрику

```python
providers.Factory(
    SqlAlchemyAsync,
    pg_settings=settings,
)
```

Далее работа с объектом сессии сводится к операциям, согласно документации библиотеки SQLAlchemy.
